---
title: paxos协议的理解
date: 2019-03-19 11:43:44
tags:
---
## **paxos**

协议分为两大阶段，每个阶段又分为A/B两小步骤：

**1.准备阶段（占坑阶段）**

第一阶段A：Proposer选择一个提议编号n，向所有的Acceptor广播Prepare（n）请求。

第一阶段B：Acceptor接收到Prepare（n）请求，若提议编号n比之前接收的Prepare请求都要大，则承诺将不会接收提议编号比n小的提议，并且带上之前Accept的提议中编号小于n的最大的提议，否则不予理会。

**2.接受阶段（提交阶段）**

第二阶段A：整个协议最为关键的点：Proposer得到了Acceptor响应

如果未超过半数accpetor响应，直接转为提议失败；

如果超过多数Acceptor的承诺，又分为不同情况：

如果所有Acceptor都未接收过值（都为null），那么向所有的Acceptor发起自己的值和提议编号n，记住，一定是所有Acceptor都没接受过值；

如果有部分Acceptor接收过值，那么从所有接受过的值中选择对应的提议编号最大的作为提议的值，提议编号仍然为n。但此时Proposer就不能提议自己的值，只能信任Acceptor通过的值，维护一但获得确定性取值就不能更改原则；

第二阶段B：Acceptor接收到提议后，如果该提议版本号不等于自身保存记录的版本号（第一阶段记录的），不接受该请求，相等则写入本地。

![paxos-flow](31902/paxos-flow.png)

